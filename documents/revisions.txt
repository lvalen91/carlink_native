// Document each versionCode revision that is tested/compiled. To keep a history of modifications the entries should be brief, but informative.
// Line formatting, [versionCode] :: <Brief but information Description. Pushed <DDMMYY HH:MM AM/PM
//
// START EXAMPLE
//
// [34] :: Troubleshooting 'AudioAttributes.USAGE' support in AAOS for the different Audio streams. Pushed: 26NOV25 11:30PM
// [35] :: Issue: Audio Distortion. Attempting fix by increasing buffer size. Pushed: 26NOV25 12:53PM
//
// END EXAMPLE
//
// Major changes or discoveries. The appropriate .MD in Project:/Documentation/ should be updated/corrected or created with more technical information.
//

[1] :: Initial Release
[2] :: Permission Prompt not shown, fixed. Ktlint issues corrected. PUSHED:
[3] :: No Video Output, bad code. Audio Output confirms connection is active/stable.
[4] :: Video output corrected.
[5] :: Video Scaling in Non-Immersive vs Immersive Corrected
[6] :: Audio Quality issue. Popping/Clipping Heard, possible parsing of header bytes. Attempting filtering.
[7] :: Status Card fix and icon upload for CarPlay 'HostUI' shortcut.
[8] :: Recovery logic on disconnects. Static Analysis corrections.
[9] :: Video Code revert back to Carlink Flutter v1.9.0
[10] :: Audio Code Testing

[11] :: Video code rewrite and lint corrections
[12] :: More Video Code testing
[13] :: Video Frame message not being recovered properly. Corrected for stable Video. PUSHED: 08DEC25 3:57PM
[14] :: Removed Status page
[15] :: Adapter Config page Testing. PUSHED: 9DEC25 11:05AM
[16] :: Video Frame Interval Change. Replaced Timer with coroutine Job. PUSHED: 10DEC25 11:50AM
[17] :: Navigation Audio Testing
[18] :: PlatformDetector was not used correctly, Fixed. Should now detected the hardware decoder and use it.
[19] :: Static Analysis warning fixes. Moved Mic from Timer to Coroutine. Though Coroutine uses a shared pool, so too many timers can cause issues.
[20]: runBlocking ANR Risk and lateinit Crash fixed. carlinkManager nullable, the receiver needed null-safe access

[21] :: Microphone Code reverted back. Timer works while coroutine does not for mic. Excessive debug logging in 'release'.
[22] :: Auto reconnect attempt on adapter disconnect. Return to App Blank Video fixed? False success on file export in some scenarios, fixed? Some UI tweaks
[23] :: Gradle Dependency updates. CarlinkMediaBrowserService now creates a foreground process in notification to hopefully keep app active. Also provide a shortcut to return to app, if it works. 
[24] :: Song Metadata inconsistency fix maybe
[25] :: App Display Mode Options. Now includes three options.
[26] :: Adapter Config settings option additions.
[27] :: Lint checks and some UI changes.
[28] :: App resume testing for Video black screen. Also testing letting app not take audio focus if adapter audio transfer is off.
[29] :: Ktlint and Detekt fixes. Refactored File Export
[30] :: Video Code change TESTING. Seems unstable or long to recover, too aggressive and compounding recovery logic.

[31] :: FIX: Progressive video quality degradation. Root cause: PacketRingByteBuffer.readPacket() used zero-copy ByteBuffer.wrap() sharing memory with ring buffer. Race condition allowed USB writes to overwrite data before MediaCodec consumed it, corrupting H.264 reference frames. Fix: Safe copy via System.arraycopy() before returning ByteBuffer. Periodic keyframes didn't help because they were also corrupted; only reset() worked because it cleared the buffer first.
[32] :: OPTIMIZATION: Eliminated double-copy in video pipeline. Added readPacketInto(ByteBuffer) method that copies directly from ring buffer to MediaCodec input buffer, eliminating intermediate byte[] allocation. Reduces GC pressure by ~3600 allocations/minute at 60fps and ~2-3% CPU overhead.
[33] :: DualStreamAudioManager.kt WRITE_NON_BLOCKING for all streams Prevents thread starvation during multi-stream playback. minBufferLevelMs reduced. AudioConfig.kt Buffer multiplier reduced across all platforms. Pre-fill threshold reduced.
[34] :: Testing why oemIcon in CarPlay does not have label.
[35] :: Navigation Audio changes.
[36] :: XDA@RWerksman mainscreen.kt fix for GM EV or non rectangular display and edge runoff. Some code cleanup, unused imports.
[37] :: Fixed App file logging not working. Added Video logging of frames for weird degradation overtime of video stream
[38] :: Code and comment cleanup
[39] :: Fixed Cluster Media info (Missing Code) Removed unnecessary permissions. car.template_host forced GPlayServices and Store to be enabled. Some users disable to free up sys resources.
[40] :: Testing Video Code caching of keyframe used as reference for P-Frames. Shorting IDR request from 5 to 2 seconds.

[41] :: More Video code changes from USB capture of video data.
[42] :: Audio Code changes based on USB capture of audio data, like 41.
[43] :: Playback feature added. Uses modified Pi-carplay captured USB binaries, injects into app audio and video pipeline. Mimics live CarPlay session for video and audio troubleshooting.
[44] :: Set androidWorkMode to true for Android Auto pairing testing.
[45] :: SPS/PPS Cache fix
[46] :: Static Analysis Tool code correction. Video Code changes according to Google H264 guidelines. Test session record
[47] :: Session Record Function Testing and some Settings UI reorganization.
[48] :: Turned off App Integrity in Play Console.
[49]:: the reset to adapter defaults resetToDefaults() now clears/forces a full init on next launch. Added log events for control UI button uses. Also testing single boxName string for all labels
[50] :: Premature Microphone release when Siri is used to start a call. Session managent will not attempt to keep microphone open when SIRI_STOP is received when a PHONECALL_START is also received.

[51] :: Video; Skip Prepending When SPS Already Present, Add Diagnostic Logging for Corruption Analysis, Updated Incorrect Comment about once per session SPS+PPS. Its every frame, Increased Search Limit on IDR Frame check.
[52] :: Some more Video tweaks. If Intel platform will attempt FULL flush, destroy, recreate of codec. Video issues might be faulty General Motor + Intel Software Design on gminfo3.7 - 3.8 hardware.
[53] :: Hid logs and session capture tabs behind a toggle. Removed Audio Sample Rate Option
[54] :: GM AAOS (gminfo3.7) optimization testing. Use Video PTS instead of synthetic timing, lower buffer sizes. Airplay.conf changes (dam icon label). Audio Thread priority change
[55] :: Audio Types based on recvd protocol command grouping for GM AAOS independent volume control via their own track. Video Code changes
[56] :: MAJOR RESTRUCTURE: Projection Video Model. "Buffer for stability, not completeness." CarPlay/Android Auto is live interactive UI, not cinema playback.
       BUFFER: Reduced from 2-4MB to 192KB jitter buffer. Packet limit 120â†’12 (~200ms).
       STALENESS: Frames >150ms old discarded at entry. Skip-to-newest-IDR on overflow.
       PTS: Monotonic synthetic only. Source PTS queue removed.
       QC: Quality Control system removed entirely (was counterproductive).
       DECODER DISCIPLINE: IDR gate (don't decode P-frames until first IDR). Stall timeout (reset+keyframe request if no output for 500ms).
       PacketRingByteBuffer: Added peekNalType(), skipToNewestIdr() methods.
       USB CAPTURE ANALYSIS: Confirmed adapter sends SPS+PPS+IDR at start, periodic IDRs (~1.4s) on request.
[57] :: CRITICAL FIX: Decoder Poisoning / Staleness Time Base Bug
       ROOT CAUSE: Staleness check compared System.currentTimeMillis() (epoch ~1.7T ms) to
       sourcePtsMs (stream-relative ~32K ms) - incompatible time bases producing meaningless results.
       All frames appeared "stale" and only passed when buffer was empty (race condition).
       This caused IDR frames to be discarded, preventing decoder recovery.

       FIX 1: DISABLED staleness check entirely - it was harmful, not just incomplete.
              Recovery now relies on: IDR gating, stall detection, buffer overflow handling.
       FIX 2: Reduced STALL_TIMEOUT_MS from 500ms to 200ms for faster recovery.
              "One reset is cheaper than ten corrupted frames."
       FIX 3: Added corruption detection via IDR tracking.
              Tracks IDRs decoded vs frames output. If multiple IDRs decoded but low output,
              decoder is "poisoned" - triggers reset. Implements concepts.txt principle:
              "If corruption survives one IDR, your decoder state is poisoned. Reset immediately."

       USB CAPTURE ANALYSIS: Verified adapter sends correct data (88 IDRs over 169s, all bundled
       with SPS+PPS, ~1.4s interval). Problem was app-side, not adapter-side.
       ADAPTER LOG ANALYSIS: Confirmed PTS is stream-relative (media time), not epoch time.
       Average frame delay from adapter: 7.85ms (well within spec).
[58] :: H264Renderer.java stall detection fix:
       - Was: lastOutputTimeMs = 0 after reset (disabled stall detection)
       - Now: lastOutputTimeMs = System.currentTimeMillis() (enables stall detection after reset)

       Added telemetry per Document 18 guidance:
       - Decode latency tracking (avg/max) in PERF logs
       - IDR interval tracking (avg/last) with >3s warning
       - Queue depth tracking (avg/max) with >5 warning
       - IDR gate drop count
       - Audio underrun count (public method for audio manager)

[59] :: H264Renderer.java telemetry fixes:
       BUG 1: Queue depth tracking was in deprecated processDataDirect() method.
              Production uses processDataDirectWithPts() which had no tracking.
       FIX 1: Added queue depth tracking to processDataDirectWithPts().

       BUG 2: IDR interval tracking was inside queueIdrWithSpsPps() success block.
              But adapter sends SPS+PPS with every IDR, so queueIdrWithSpsPps() returns
              false (line 2109: "Packet already has SPS - queue as-is without prepending").
              Result: IDR interval telemetry never recorded for live adapter streaming.
       FIX 2: Moved IDR tracking outside queueIdrWithSpsPps() success block.
              Now tracks ALL IDR frames regardless of whether SPS/PPS injection happens.
              Applied to both tryQueueToCodec() and feedCodecFromBuffer() code paths.
[60] :: Select different resolution

[61] :: Video Code refactoring. Basically revert back to abuharsky app simplicity. Code cleanup elsewhere. Documentation updates
[62] :: More Code Cleanup. Adjusted Log File Export, Corrected Custom Resolution Options, even more Video logging areas.
[63] :: More Video Log to logcat. Trying to narrow down root cause of video issues observed on gminfo3.7
[64] :: H264Renderer.java MAX_BUFFER_PACKETS from 10 to 2
[65] :: Dependency Updates
[66] :: Video Direct Handoff to MediaCodec, no buffering. Codec is fed inline on the USB thread. NAL Type 30s logcat logging. Back to two audio output streams (Nav + Everything else) for simplification. Audio zero-copy, buffer tuning. Microphone cleanup. Just a bunch of cleaning up. Added media delay option to adapter config
[67] :: Decoupling (Single-Slot Handoff) Video-Audio to allow interrupted Video and Audio if GC Pressure occurs.
[68] :: Some Code cleanup
[69] :: Nice. More cleanup. Testing cmd inject for oemIconLabel
[70] :: Navi Metadata testing. Hybrid CarApp Activity 'silently' opens without taking focus from MainActivity.

[71] :: Testing GM Cluster Nav Metadata integration. AOSP/Vanilla AOSP works fine, but not GM AAOS.
[72] :: Stale Nav Icons and Name fix test
[73] :: Duplicate trip code. Location access and forwarding to CPC200-CCPA adapter. Set needed firmware settings via command injection
[74] :: Log code cleanup. Curved Display in Widescreen SafeArea Code Testing. OS Sets cutout bounds, app calculates padding for SafeArea if user selects a non-default DisplayMode in App Settings (hide status or immersive).